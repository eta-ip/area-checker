<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</title>
  <link rel="stylesheet" href="https://eta-ip.com/css/style.css">
</head>
<style>  /* å¤§å®¹é‡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ */
.upload-box {max-width:600px; margin:20px auto 10px; padding:50px 20px; border:2px dashed #ccc; border-radius:10px; text-align:center; transition:border-color 0.3s ease-in-out;}
.upload-box.dragover {border-color:#d4a373;}
.button {margin-top:20px; padding:12px 28px; font-size:16px; font-weight:bold; border:none; border-radius:6px; background-color:#d4a373; color:#fff; cursor:pointer; transition:background-color 0.2s;}
.button:hover {background-color:#c6905f;}
input[type="file"] {display:none;}
.note {margin-top:15px; font-size:14px; color:#888;}
#message {max-width:600px; margin:10px auto 20px; padding:12px; font-size:16px; text-align:center; color:#0d3e19; border:1px solid #c3e6cb; border-radius:6px; display:none;}
.success {font-weight:bold;}
#fileList {max-width:600px; margin:20px auto; padding:20px; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,0.1);}
.file-item {display:flex; flex-direction:column; align-items:flex-start; justify-content:space-between; padding:8px 0; border-bottom:1px solid #eee;}
.progress {width:100%; height:8px; margin-top:5px; background:#d4a373; border-radius:4px; overflow:hidden;}
.progress-inner {width:0%; height:100%; background:#efc397; transition:width 0.3s ease;}
.link-box {margin-top:15px; padding:8px; font-size:14px; color:#333; border-left:4px solid #ffe2c6; word-break:break-word;}
.remove-button {margin-left:10px; font-size:14px; color:red; background:none; border:none; cursor:pointer;}
.warn {margin-top:5px; color:red;}
.total-size {margin-top:15px; font-size:14px; font-weight:bold; color:#333;}
#clearAllBtn {margin-top:10px; background-color:#999;}
#clearAllBtn:hover {background-color:#777;}
</style>
<body>
<header>
  <p id="logo">
    <a href="https://eta-ip.com/index.html">
      <img src="https://eta-ip.com/img/logo.png" alt="ä¸€ç´šå»ºç¯‰å£«äº‹å‹™æ‰€ ã‚¨ã‚¤ã‚¿å›½éš›ä¼ç”»ã®ãƒ­ã‚´">
    </a>
  </p>
  <div id="menubar_hdr" role="button" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ‡æ›¿" tabindex="0">
    <span></span><span></span><span></span>
  </div>
  <div id="menubar" class="d-n">
    <nav>
      <ul>
        <li><a href="https://eta-ip.com/projects.html" class="btn00"><span class="btn00__text">Projects</span><span class="btn00__text">æ–½å·¥å®Ÿç¸¾</span></a></li>
        <li><a href="https://eta-ip.com/corporate.html" class="btn00"><span class="btn00__text">Profile</span><span class="btn00__text">ä¼æ¥­æƒ…å ±</span></a></li>
        <li><a href="https://eta-ip.com/flow.html" class="btn00"><span class="btn00__text">Workflow</span><span class="btn00__text">è¨­è¨ˆã®æµã‚Œ</span></a></li>
        <li><a href="https://eta-ip.com/contact.php" class="btn00"><span class="btn00__text">Contact Us</span><span class="btn00__text">ãŠå•ã„åˆã‚ã›</span></a></li>
      </ul>
    </nav>
  </div>
</header>

<div id="container">
  <main id="contents">
    <section aria-labelledby="section-title-flow">
      <h1 id="section-title-flow">ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸</h1>
        <div id="uploadArea">
      <label for="comment" style="font-weight: bold;text-align: center; display: block; margin-bottom: 5px;margin-top: 100px;">ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ã‚ãŸã‚Šæœ€å¤§ 256MBï¼‰</label>
      <div class="upload-box" id="dropArea">
        <p>ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯</p>
        <button class="button" onclick="document.getElementById('fileInput').click();">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
        <input type="file" id="fileInput" multiple>
        <p class="note">â€» æœ€å¤§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®¹é‡ï¼šåˆè¨ˆ:1GBï¼ç¦æ­¢å½¢å¼ï¼šexe, php, bat, sh</p>
      </div>

      <div style="max-width: 600px; margin: 20px auto;">
        <label for="comment" style="font-weight: bold; text-align: center;display: block; margin-bottom: 5px;margin-top: 100px;">é€ä¿¡è€…ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰</label>
        <textarea id="comment" rows="4" placeholder="ä¾‹ï¼šå›³é¢ä¸€å¼ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 15px;"></textarea>
      </div></div>

      <div id="message"></div>
      <div id="fileList"></div>

      <div id="termsContainer" style="max-width: 600px; margin: 10px auto; font-size: 17px;">
        <label style="display: flex; align-items: center; justify-content: center; gap: 6px;">
          <input type="checkbox" id="agreeTerms">
          <span><a href="terms.html" target="_blank" style="color: #b65d03; text-decoration: underline;">åˆ©ç”¨è¦ç´„</a> ã«åŒæ„ã—ã¾ã™ã€‚</span>
        </label>
        <p id="termsHint" style="color:#999; font-size: 14px; text-align:center; display:none;">
          â€»åˆ©ç”¨è¦ç´„ã«åŒæ„ã™ã‚‹ã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™
        </p>
      </div>

      <div style="text-align: center;">
        <button class="button" id="startUploadBtn" disabled>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹</button>
        <button class="button" id="clearAllBtn" style="display:none;">ã™ã¹ã¦å‰Šé™¤</button>
      </div>
    </section>
  </main>
</div>

  <script>
    const dropArea = document.getElementById("dropArea");
    const fileInput = document.getElementById("fileInput");
    const fileList = document.getElementById("fileList");
    const startUploadBtn = document.getElementById("startUploadBtn");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const message = document.getElementById("message");
    const commentInput = document.getElementById("comment");

    const MAX_SIZE = 256 * 1024 * 1024;
    const forbiddenExtensions = ['exe', 'php', 'bat', 'sh'];
    let selectedFiles = [];

    dropArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropArea.classList.add("dragover");
    });

    dropArea.addEventListener("dragleave", () => {
      dropArea.classList.remove("dragover");
    });

    dropArea.addEventListener("drop", (e) => {
      e.preventDefault();
      dropArea.classList.remove("dragover");
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener("change", () => {
      handleFiles(fileInput.files);
    });

    clearAllBtn.addEventListener("click", () => {
      selectedFiles = [];
      fileList.innerHTML = '';
      updateTotalSize();
      startUploadBtn.disabled = true;
      clearAllBtn.style.display = 'none';
    });

    function handleFiles(files) {
      message.style.display = "none";
      message.textContent = "";
      fileList.querySelectorAll(".warn").forEach(el => el.remove());
      for (const file of files) {
        const parts = file.name.split('.');
        const ext = parts.length > 1 ? parts.pop().toLowerCase() : '';
        if (forbiddenExtensions.includes(ext)) {
          const warn = document.createElement("div");
          warn.textContent = `âš ï¸ æ‹’å¦ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ï¼ˆ.${ext}ï¼‰: ${file.name}`;
          warn.className = "warn";
          fileList.appendChild(warn);
          continue;
        }
        if (file.size > MAX_SIZE) {
          const warn = document.createElement("div");
          warn.textContent = `âš ï¸ ã‚µã‚¤ã‚ºè¶…éï¼ˆ256MBä»¥ä¸Šï¼‰: ${file.name}`;
          warn.className = "warn";
          fileList.appendChild(warn);
          continue;
        }
        const duplicate = selectedFiles.some(f => f && f.name === file.name && f.size === file.size);
        if (duplicate) continue;
        const index = selectedFiles.length;
        selectedFiles.push(file);
        const div = document.createElement("div");
        div.className = "file-item";
        div.id = `file-item-${index}`;
        div.innerHTML = `
          <div>${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MBï¼‰<button class="remove-button" onclick="removeFile(${index})">ğŸ—‘å‰Šé™¤</button></div>
          <div class="progress"><div class="progress-inner" id="progress-${index}"></div></div>
          <div id="link-${index}"></div>
        `;
        fileList.appendChild(div);
      }
      updateTotalSize();
      toggleUploadButton();
      clearAllBtn.style.display = selectedFiles.some(f => f !== null) ? 'inline-block' : 'none';
    }

    function removeFile(index) {
      const item = document.getElementById(`file-item-${index}`);
      if (item) item.remove();
      selectedFiles[index] = null;
      updateTotalSize();
      toggleUploadButton();
      clearAllBtn.style.display = selectedFiles.some(f => f !== null) ? 'inline-block' : 'none';
    }

    function updateTotalSize() {
      const existing = document.getElementById("total-size");
      if (existing) existing.remove();
      const total = selectedFiles.reduce((sum, f) => f ? sum + f.size : sum, 0);
      if (total > 0) {
        const totalDiv = document.createElement("div");
        totalDiv.id = "total-size";
        totalDiv.className = "total-size";
        totalDiv.textContent = `ğŸ“¦ åˆè¨ˆã‚µã‚¤ã‚º: ${(total / 1024 / 1024).toFixed(2)} MB`;
        fileList.appendChild(totalDiv);
      }
    }

    startUploadBtn.addEventListener("click", () => {
      message.style.display = "none";
      message.textContent = "";
      const validFiles = selectedFiles.map((file, index) => ({ file, index })).filter(item => item.file !== null);
      let completedCount = 0;
      let hasError = false;
      validFiles.forEach(({ file, index }) => {
        uploadFile(file, index, (errorOccurred) => {
          completedCount++;
          if (errorOccurred) hasError = true;
          if (completedCount === validFiles.length) {
            if (hasError) {
              message.innerHTML = `<span class="success" style="color:red;">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</span>`;
            } else {
              message.innerHTML = `<span class="success">âœ… å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ç¢ºèªå¾Œã€æ‹…å½“è€…ã‚ˆã‚Šã”é€£çµ¡å·®ã—ä¸Šã’ã¾ã™ã€‚</span>`;document.getElementById("uploadArea").style.display = "none";document.getElementById("section-title-flow").textContent = "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†";
            }
            document.querySelectorAll(".remove-button").forEach(btn => btn.style.display = "none");
            message.style.display = "block";
            commentInput.value = "";
            startUploadBtn.style.display = "none";
            clearAllBtn.style.display = "none";
            const doneButton = document.createElement("a");
            doneButton.href = "https://eta-ip.com";
            doneButton.textContent = "å®Œäº†";
            doneButton.className = "button";
            doneButton.style.marginTop = "20px";
            doneButton.style.display = "inline-block";
            doneButton.style.textDecoration = "none";
            message.appendChild(document.createElement("br"));
            message.appendChild(doneButton);
          }
        });
      });
    });

    function uploadFile(file, index, callback) {
      const formData = new FormData();
      formData.append("file", file);
      formData.append("comment", commentInput.value);
      const xhr = new XMLHttpRequest();
      xhr.open("POST", "../backend/upload.php", true);
      xhr.upload.onprogress = function (e) {
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          const progressBar = document.getElementById("progress-" + index);
          if (progressBar) progressBar.style.width = percent + "%";
        }
      };
      xhr.onload = function () {
        const linkBox = document.getElementById("link-" + index);
        if (xhr.status === 200) {
          try {
            const res = JSON.parse(xhr.responseText);
            if (res && res.url) {
              linkBox.innerHTML = `<div class="link-box">ğŸ”— <a href="${res.url}" target="_blank">${res.url}</a><br>ğŸ•’ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯24æ™‚é–“å¾Œã«è‡ªå‹•å‰Šé™¤ã•ã‚Œã¾ã™</div>`;
              callback(false);
            } else {
              linkBox.innerHTML = `<span style="color: red;">âŒ ãƒªãƒ³ã‚¯ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ</span>`;
              callback(true);
            }
          } catch {
            linkBox.innerHTML = `<span style="color: red;">âŒ å¿œç­”å½¢å¼ã‚¨ãƒ©ãƒ¼</span>`;
            callback(true);
          }
        } else {
          linkBox.innerHTML = `<span style="color: red;">âŒ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—ï¼ˆHTTP ${xhr.status}ï¼‰</span>`;
          callback(true);
        }
      };
      xhr.onerror = function () {
        const linkBox = document.getElementById("link-" + index);
        linkBox.innerHTML = `<span style="color: red;">âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼</span>`;
        callback(true);
      };
      xhr.send(formData);
    }
  </script>
<script>
  const agreeTerms = document.getElementById("agreeTerms");
  const termsContainer = document.getElementById("termsContainer");
  const termsHint = document.getElementById("termsHint");

  function toggleUploadButton() {
    const hasFile = selectedFiles.some(f => f !== null);
    const enabled = agreeTerms.checked && hasFile;
    startUploadBtn.disabled = !enabled;
    termsHint.style.display = enabled ? 'none' : 'block';
  }

  agreeTerms.addEventListener("change", toggleUploadButton);

  startUploadBtn.addEventListener("click", () => {
    termsContainer.style.display = "none";
  });
</script>

<footer>
<small>&copy; 2024 <a href="https://eta-ip.com/index.html">ETA LLC.</a></small><br>
<address>ã€’198-0046 æ±äº¬éƒ½é’æ¢…å¸‚æ—¥å‘å’Œç”°2-928<br></address>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vegas/2.5.4/vegas.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/protonet-jquery.inview/1.1.2/jquery.inview.min.js" defer></script>
  <script src="https://eta-ip.com/js/jquery.inview_set.js" defer></script>
  <script src="https://eta-ip.com/js/main.js" defer></script>
</body>
</html>
